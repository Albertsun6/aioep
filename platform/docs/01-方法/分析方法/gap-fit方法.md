# Gap-Fit 分析方法

> 状态: **已验证** | 版本: v0.3.0 | 创建: 2026-02-16 | 上次验证: 2026-02-17（ERP 项目采购域完整验证 + AIOEP 自举验证）

## 定位

指导如何将结构化需求与现有能力（标准平台功能 / 已有实现）逐项对比，找出差距并制定处理策略。适用于 ERP 项目（对比 Odoo 标准功能）和平台项目（对比当前实现状态）。

对应 TOGAF Phase B-D 的差距分析环节。

## 前置条件

- 战略规划已完成（优先级已排定）
- 需求来源已识别（BRD / 设计文档 / 用户故事）
- 对比基线可访问（Odoo 开发环境 / 仓库文件系统）

## 步骤

### Step 1: 收集结构化需求列表

**做什么**：从需求来源中提取可逐项评估的需求条目，每条需求粒度应为"一个可独立评估的功能点"。

**AI 引导问题**：
1. 需求来源有哪些文档？（BRD / 设计文档 / 用户故事 / 会议纪要）
2. 需求按什么维度组织？（按模块 / 按业务流程 / 按用户角色）
3. 每条需求是否足够具体，可以独立判断"有还是没有"？

**操作要点**：
- 给每条需求编号（REQ-001, REQ-002, ...）
- 按模块或业务域分组
- 如果需求过于笼统（如"管理库存"），拆分为子需求（如"入库登记"、"库存预警"、"盘点"）

**输出**：需求清单（填入 Gap-Fit 报告模板的"编号"和"需求描述"列）

### Step 2: 逐项对比现有能力

**做什么**：对每条需求，查找现有能力中是否有对应的功能或实现。

**AI 引导问题**：
1. 每条需求在当前平台/系统中有没有对应功能？
2. 如果有，功能覆盖度如何？（完全覆盖 / 部分覆盖 / 需要配置）
3. 如果没有，最接近的功能是什么？差多远？

**操作要点**：
- **ERP 场景**：在 Odoo Docker 环境中实际探索标准模块，记录对应功能和路径
- **平台场景**：检查仓库文件系统，确认文件是否存在、内容是否完整
- 记录对比证据（截图 / 文件路径 / 功能描述），不能凭印象判断

> **Odoo 标准模块探索技巧**（试跑经验）：
> - 使用 JSON-RPC API 批量查询模块状态比浏览器逐个检查更高效：`curl -s -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","method":"call","params":{"service":"object","method":"execute_kw","args":["db","uid","pwd","ir.module.module","search_read",[["name","in",["sale","purchase","stock","account"]]]]}}'`
> - Odoo 设置页面的"功能开关"是判断 Fit/Gap 的关键入口——很多 Partial 的需求只需启用配置
> - 注意 Odoo 模块间的依赖链：安装 `sale` 会自动安装 `sale_management`，进而影响 `product` 的字段和行为
> - 记录时标注 Odoo 版本（17.0 Community vs Enterprise），避免误判 Enterprise 专属功能为 Fit

**输出**：填入 Gap-Fit 报告模板的"现有能力/标准功能"列

### Step 3: 标记匹配度

**做什么**：根据 Step 2 的对比结果，给每条需求标记匹配度。

**匹配度定义**：

| 标记 | 含义 | 判断标准 |
|------|------|---------|
| **Fit** | 完全匹配 | 现有功能直接满足需求，无需修改或仅需简单配置 |
| **Partial** | 部分匹配 | 现有功能覆盖 30%~70%，需补充或定制 |
| **Gap** | 完全缺失 | 没有对应功能，需从头开发/创建 |
| **OOS** | 超出范围 | 当前版本不要求，推迟到后续版本 |

**AI 引导问题**：
1. 这条需求的现有功能覆盖了多少比例？
2. 缺失的部分是核心逻辑还是边缘功能？
3. 这条需求是否属于当前版本的范围？

**输出**：填入 Gap-Fit 报告模板的"匹配度"列

### Step 4: 制定处理策略

**做什么**：对每个非 Fit 的需求项，制定具体的处理策略。

**策略优先级**（从低成本到高成本）：

| 策略 | 适用场景 | 成本 | 示例 |
|------|---------|------|------|
| **配置** | 功能存在但未启用或需参数调整 | 最低 | Odoo 启用模块 / 修改系统参数 |
| **补充** | 框架存在但内容不完整 | 低 | 细化纲要文档 / 补充模板 |
| **继承扩展** | 标准功能接近但需扩展字段或逻辑 | 中 | Odoo _inherit / 扩展 Skill |
| **新建** | 无对应功能，需完全新建 | 高 | 新建 Odoo 模块 / 新建方法文件 |
| **外部集成** | 需对接外部服务或工具 | 高 | API 对接 / 工具桥接 |

**原则**：配置优先于补充，补充优先于扩展，扩展优先于新建，新建优先于外部集成。

**AI 引导问题**：
1. 能不能通过配置解决？（最低成本路径）
2. 如果需要开发，改现有的还是建新的？
3. 有没有开源方案或现成工具可以集成？

**输出**：填入 Gap-Fit 报告模板的"处理策略"列

### Step 5: 估算工作量

**做什么**：对每个需要处理的需求项估算工作量。

**工作量定义**（T-shirt Sizing）：

| 级别 | 含义 | 参考时间（1 人） |
|------|------|----------------|
| **S** | 小工作量 | 0.5~1 天 |
| **M** | 中等工作量 | 2~3 天 |
| **L** | 较大工作量 | 1~2 周 |
| **XL** | 大工作量 | 2 周以上（建议拆分） |

**估算规则**：
- Fit 项不需要估算（工作量为 0）
- OOS 项不需要估算（不在范围内）
- XL 项应拆分为多个 M 或 L
- 估算包含开发 + 测试 + 文档

**AI 引导问题**：
1. 类似的任务以前做过吗？花了多久？
2. 这个工作量有没有隐藏依赖？（需要先完成其他任务）
3. XL 级别的能否拆分成更小的交付单元？

**输出**：填入 Gap-Fit 报告模板的"工作量"列

### Step 6: 按优先级排序，输出行动计划

**做什么**：综合战略优先级和工作量，排出执行顺序，形成可执行的行动计划。

**排序规则**：
1. **P0 先做**：高优先级 + 小工作量 → 最先排期
2. **P0 大件拆分**：高优先级 + 大工作量 → 拆分后分批排入
3. **P1 补充**：中优先级按工作量排序
4. **P2/P3 放入 Backlog**

**输出格式**：
- 按优先级分组的行动项列表
- 每项包含：编号、行动描述、对应需求、工作量、触发时机
- Sprint 规划建议（如适用）

**AI 引导问题**：
1. P0 行动项是否可以在下一轮对话中立即执行？
2. P1 行动项的触发时机是什么？（某个活动开始前 / 某个 Phase 前）
3. 有没有行动项之间的依赖关系需要注意？

**输出**：
- Gap-Fit 报告的"行动计划"章节
- Phase 2 Sprint 规划输入（如适用）

> **Gap-Fit → Sprint 规划的衔接**（试跑经验）：
> - Gap-Fit 报告中的处理策略直接决定 Sprint 内容：`配置` 类需求归入 Sprint 0，`继承扩展/新建` 类按业务域分到 Sprint 1~N
> - 试跑验证了此衔接模式：Sprint 0 完成了所有"配置"类需求（货币、审批开关、采购协议等），Sprint 1 完成了"继承扩展"类需求（`erp_purchase_approval`）
> - 建议在 Gap-Fit 报告中直接标注"建议 Sprint"列，减少规划时的重复分析

## 模板

空白模板：[模板-gap-fit报告.md](./模板-gap-fit报告.md)（复制到项目层使用）

## 检查清单

- [ ] 所有需求项都已评估（无遗漏）
- [ ] 每项都有明确的匹配度标记（Fit/Partial/Gap/OOS 四选一）
- [ ] 每个非 Fit 项都有处理策略
- [ ] 工作量估算合理（无 XL 项或已拆分）
- [ ] 处理策略遵循"配置优先于定制，定制优先于重写"
- [ ] P0 行动项可在 1~2 轮对话内完成
- [ ] 行动项之间的依赖关系已识别

## 输出

- `docs/02-项目/gap-fit报告.md`（Gap-Fit 分析报告）
- 行动计划（按优先级分级，含工作量和触发时机）
- Phase 2 Sprint 规划输入（如适用）

## 方法论引用

- [TOGAF Gap-Fit](../../00-方法论/02-过程方法论/togaf.md)（分析框架）
- [SDLC Phase 1](../../00-方法论/02-过程方法论/sdlc.md)（Gap-Fit 是 Phase 1 核心活动）

---

## 变更记录

| 版本 | 日期 | 修改内容 |
|------|------|---------|
| v0.1.0 | 2026-02-16 | 纲要创建 |
| v0.2.0 | 2026-02-17 | 细化 6 个步骤：AI 引导问题、操作要点、匹配度/策略/工作量定义表、检查清单扩展 |
| v0.3.0 | 2026-02-17 | ERP 项目采购域验证：新增 Odoo 模块探索技巧（JSON-RPC 批量查询、功能开关、依赖链注意事项）、Gap-Fit→Sprint 衔接经验、状态更新为"已验证" |
