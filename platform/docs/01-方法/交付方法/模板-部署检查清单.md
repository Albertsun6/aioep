# 部署检查清单（模板）

> 类型: **模板** | 版本: v0.1.0 | 创建: 2026-02-17
>
> 项目名称: [项目名]
> 部署日期: [YYYY-MM-DD]
> 部署负责人: [姓名]
> 文档版本: v0.1

---

## Section 1: 环境准备检查

### 1.1 服务器配置

| 项目 | 要求 | 实际配置 | 达标 |
|------|------|---------|------|
| CPU | ≥ [N] 核 | | ✅/❌ |
| 内存 | ≥ [N] GB | | ✅/❌ |
| 存储 | ≥ [N] GB（SSD） | | ✅/❌ |
| 操作系统 | Ubuntu [版本] / [其他] | | ✅/❌ |
| Docker 版本 | ≥ [N] | | ✅/❌ |
| Docker Compose 版本 | ≥ [N] | | ✅/❌ |

### 1.2 网络与域名

| 项目 | 状态 | 备注 |
|------|------|------|
| 域名解析配置 | ✅/❌ | |
| SSL 证书 | ✅/❌ | 证书有效期至 [日期] |
| DNS TTL 已调低（≤ 300s） | ✅/❌ | |
| 防火墙规则（80/443） | ✅/❌ | |

### 1.3 Docker Compose 生产配置

| 检查项 | 状态 | 备注 |
|--------|------|------|
| `docker-compose.prod.yml` 存在 | ✅/❌ | |
| `.env` 文件配置完成 | ✅/❌ | 不在 Git 中 |
| 数据卷挂载到宿主机 | ✅/❌ | |
| 容器资源限制已设置 | ✅/❌ | |
| Odoo `list_db = False` | ✅/❌ | |
| Odoo `proxy_mode = True` | ✅/❌ | |
| Odoo workers 数量 | [N] | 推荐: CPU * 2 + 1 |

### 1.4 PostgreSQL 配置

| 参数 | 推荐值 | 实际值 | 达标 |
|------|--------|--------|------|
| `shared_buffers` | RAM * 25% | | ✅/❌ |
| `work_mem` | 64MB | | ✅/❌ |
| `effective_cache_size` | RAM * 75% | | ✅/❌ |
| `max_connections` | ≥ workers * 2 | | ✅/❌ |

### 1.5 Nginx 配置

| 检查项 | 状态 | 备注 |
|--------|------|------|
| SSL 配置 | ✅/❌ | |
| HTTP → HTTPS 跳转 | ✅/❌ | |
| 静态文件缓存 | ✅/❌ | `/web/static/` |
| `client_max_body_size` | [N]M | |
| `proxy_read_timeout` | [N]s | 推荐 720s |

### 1.6 备份配置

| 检查项 | 状态 | 备注 |
|--------|------|------|
| `pg_dump` 定时任务 | ✅/❌ | cron 时间: [HH:MM] |
| filestore 备份 | ✅/❌ | |
| 备份保留天数 | [N] 天 | 推荐 ≥ 7 天 |
| 备份恢复验证 | ✅/❌ | 上次验证日期: [日期] |
| 备份存储位置 | [本地/云存储/异地] | |

### 1.7 监控配置

| 检查项 | 状态 | 备注 |
|--------|------|------|
| 服务状态监控 | ✅/❌ | |
| 磁盘空间告警 | ✅/❌ | 阈值: [N]% |
| 日志收集 | ✅/❌ | |
| 告警通知渠道 | [邮件/短信/即时通讯] | |

**Section 1 检查人**: [姓名] | **日期**: [YYYY-MM-DD] | **结论**: [就绪 / 未就绪]

---

## Section 2: 数据迁移校验

### 2.1 迁移范围确认

| 数据分类 | 迁移策略 | 源系统记录数 | 备注 |
|---------|---------|------------|------|
| 产品（product.template） | 全量 | | |
| 供应商（res.partner） | 全量 | | |
| 客户（res.partner） | 全量 | | |
| 采购订单（purchase.order） | 截止日: [日期] | | |
| 销售订单（sale.order） | 截止日: [日期] | | |
| 库存移动（stock.move） | 截止日: [日期] | | |
| 财务凭证（account.move） | 截止日: [日期] | | |
| 附件 | 按需 | | |

### 2.2 记录数校验

| 模型 | 旧系统 | 新系统 | 差异 | 达标 | 备注 |
|------|--------|--------|------|------|------|
| product.template | | | | ✅/❌ | |
| res.partner（供应商） | | | | ✅/❌ | |
| res.partner（客户） | | | | ✅/❌ | |
| purchase.order | | | | ✅/❌ | |
| sale.order | | | | ✅/❌ | |
| stock.move | | | | ✅/❌ | |
| account.move | | | | ✅/❌ | |

### 2.3 金额汇总校验

| 指标 | 旧系统 | 新系统 | 差异 | 达标 |
|------|--------|--------|------|------|
| 采购总金额 | | | | ✅/❌ |
| 销售总金额 | | | | ✅/❌ |
| 库存价值总计 | | | | ✅/❌ |
| 应收账款余额 | | | | ✅/❌ |
| 应付账款余额 | | | | ✅/❌ |

### 2.4 关键字段抽样检查

| 抽样对象 | 抽样数量 | 通过数 | 失败数 | 通过率 | 备注 |
|---------|---------|--------|--------|--------|------|
| 产品（价格+库存） | | | | [N]% | |
| 供应商（联系方式） | | | | [N]% | |
| 订单（金额+状态） | | | | [N]% | |

### 2.5 关联完整性检查

| 检查项 | 结果 | 备注 |
|--------|------|------|
| PO 的供应商均存在 | ✅/❌ | |
| SO 的客户均存在 | ✅/❌ | |
| Invoice 关联的订单存在 | ✅/❌ | |
| Stock Move 的产品存在 | ✅/❌ | |
| 孤立记录数 | [N] 条 | |

**Section 2 检查人**: [姓名] | **日期**: [YYYY-MM-DD] | **结论**: [数据一致 / 存在差异需处理]

---

## Section 3: 上线执行检查

### 3.1 部署前确认

| 检查项 | 状态 | 确认人 |
|--------|------|--------|
| 生产数据库最终备份已完成 | ✅/❌ | |
| 自定义模块版本与 staging 一致 | ✅/❌ | |
| DNS TTL 已调低 | ✅/❌ | |
| 停机通知已发送 | ✅/❌ | |
| 回滚方案已演练 | ✅/❌ | |

### 3.2 部署执行记录

| 时间 | 活动 | 状态 | 耗时 | 备注 |
|------|------|------|------|------|
| [HH:MM] | 旧系统设为只读 | ✅/❌ | [N] min | |
| [HH:MM] | 最终增量数据迁移 | ✅/❌ | [N] min | |
| [HH:MM] | 新系统容器启动 | ✅/❌ | [N] min | |
| [HH:MM] | 模块升级执行 | ✅/❌ | [N] min | |
| [HH:MM] | 数据迁移校验 | ✅/❌ | [N] min | |
| [HH:MM] | DNS 切换 | ✅/❌ | [N] min | |
| [HH:MM] | SSL 验证 | ✅/❌ | [N] min | |
| [HH:MM] | 部署后验证 | ✅/❌ | [N] min | |
| **总计** | | | **[N] min** | |

### 3.3 部署后验证

| 验证项 | 结果 | 备注 |
|--------|------|------|
| 登录页可访问 | ✅/❌ | |
| 管理员登录成功 | ✅/❌ | |
| 采购订单列表加载 | ✅/❌ | |
| 创建新 PO 成功 | ✅/❌ | |
| 库存看板加载 | ✅/❌ | |
| 完整业务流程走通 | ✅/❌ | |

### 3.4 是否触发回滚？

```
触发回滚: [ ] 是  [ ] 否
触发原因: [如有]
回滚时间: [如有]
回滚结果: [如有]
```

**Section 3 执行人**: [姓名] | **日期**: [YYYY-MM-DD] | **结论**: [上线成功 / 已回滚]

---

## Section 4: 回滚演练记录

### 4.1 演练信息

| 项目 | 内容 |
|------|------|
| 演练日期 | [YYYY-MM-DD] |
| 演练环境 | staging |
| 参与人员 | [姓名列表] |

### 4.2 回滚步骤执行

| 步骤 | 操作 | 耗时 | 结果 | 备注 |
|------|------|------|------|------|
| 1 | 停止新系统容器 | [N] min | ✅/❌ | |
| 2 | 恢复旧数据库备份 | [N] min | ✅/❌ | |
| 3 | DNS 切回旧服务器 | [N] min | ✅/❌ | |
| 4 | 验证旧系统运行 | [N] min | ✅/❌ | |
| 5 | 通知相关人员 | [N] min | ✅/❌ | |
| **总计** | | **[N] min** | | 目标 < 30 min |

### 4.3 回滚后数据完整性

| 检查项 | 结果 | 备注 |
|--------|------|------|
| 数据库记录数正确 | ✅/❌ | |
| 回滚前后数据一致 | ✅/❌ | |
| 业务操作正常 | ✅/❌ | |

**Section 4 演练负责人**: [姓名] | **日期**: [YYYY-MM-DD] | **结论**: [演练通过 / 需改进]

---

## Section 5: 上线后健康检查

### 5.1 即时健康检查（上线后 30 min）

| 检查项 | 命令/方式 | 结果 | 达标 |
|--------|---------|------|------|
| Odoo 服务状态 | `curl -s -o /dev/null -w "%{http_code}" [URL]` | [状态码] | ✅/❌ |
| 数据库连接 | `pg_isready` | | ✅/❌ |
| Nginx 状态 | `nginx -t` | | ✅/❌ |
| 磁盘空间 | `df -h` | [可用 %] | ✅/❌ |
| 容器状态 | `docker ps` | 全部 Up | ✅/❌ |
| 错误日志 | `docker logs --tail 100` | 无 ERROR | ✅/❌ |

### 5.2 每日健康检查（上线后 1 周）

| 日期 | 数据库大小 | 错误日志数 | 平均响应时间 | 用户反馈 | 备注 |
|------|-----------|-----------|-------------|---------|------|
| Day 1 | | | | | |
| Day 2 | | | | | |
| Day 3 | | | | | |
| Day 4 | | | | | |
| Day 5 | | | | | |
| Day 6 | | | | | |
| Day 7 | | | | | |

**Section 5 检查人**: [姓名] | **日期**: [YYYY-MM-DD]

---

## 综合判定

| 阶段 | 结论 | 备注 |
|------|------|------|
| 环境准备 | 就绪/未就绪 | |
| 数据迁移 | 数据一致/存在差异 | |
| 上线执行 | 成功/已回滚 | |
| 回滚演练 | 通过/需改进 | |
| 健康检查 | 正常/异常 | |
| **整体判定** | **上线完成 / 需进一步处理** | |

---

> 报告编制: [姓名] | 日期: [YYYY-MM-DD]
> 审核确认: [姓名] | 日期: [YYYY-MM-DD]
