# 开发平台规划

> 文档版本: v0.4.0 | 创建日期: 2026-02-15 | 更新: 2026-02-18 | 状态: 部分实现
>
> Web Dashboard MVP 已按本规划实现（Next.js + Ant Design），详见 `web/` 目录。
>
> **所属层级**：AI-EADM for Odoo（方法层）
> **上游方法论**：[AI-EADM 方法论](../00-方法论/README.md) | **关联**：[Odoo 设计模式](./odoo-patterns.md) / [AI 协作协议](../00-方法论/07-AI协作协议/README.md)

---

## 1. 开发平台定位

### 1.1 什么是开发平台

开发平台不是一个产品，而是**支撑 ERP 开发的工具链、规范、模板和自动化流程的集合**。它的目标是：

- 让 AI 编程助手在统一的规范下高效产出
- 让开发者（人类）专注于业务决策和质量把控
- 让每个 Odoo 模块的开发过程标准化、可复制
- 让知识沉淀在项目中，而非开发者脑中

### 1.2 平台架构总览

```
┌─────────────────────────────────────────────────────────────────┐
│                       开发平台架构                                │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │                    开发者工作台                            │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐              │     │
│  │  │ Cursor   │  │ 浏览器    │  │ 终端      │              │     │
│  │  │ IDE      │  │ Odoo UI  │  │ Docker   │              │     │
│  │  └──────────┘  └──────────┘  └──────────┘              │     │
│  └─────────────────────────────────────────────────────────┘     │
│                              │                                    │
│  ┌───────────────────────────▼─────────────────────────────┐     │
│  │                   AI 辅助层                               │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐              │     │
│  │  │ Cursor   │  │ Prompt   │  │ Chatlog  │              │     │
│  │  │ Rules    │  │ 模板库   │  │ 上下文   │              │     │
│  │  └──────────┘  └──────────┘  └──────────┘              │     │
│  └─────────────────────────────────────────────────────────┘     │
│                              │                                    │
│  ┌───────────────────────────▼─────────────────────────────┐     │
│  │                   工程化基础设施                           │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌────────┐ │     │
│  │  │ 模块脚手 │  │ 代码质量 │  │ CI/CD    │  │ Docker │ │     │
│  │  │ 架生成器 │  │ 检查工具 │  │ 流水线   │  │ 环境   │ │     │
│  │  └──────────┘  └──────────┘  └──────────┘  └────────┘ │     │
│  └─────────────────────────────────────────────────────────┘     │
│                              │                                    │
│  ┌───────────────────────────▼─────────────────────────────┐     │
│  │                    Odoo 运行环境                          │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐              │     │
│  │  │ Odoo 17  │  │PostgreSQL│  │  Redis   │              │     │
│  │  │ Server   │  │    16    │  │    7     │              │     │
│  │  └──────────┘  └──────────┘  └──────────┘              │     │
│  └─────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 项目目录结构概览

```
erp/
├── .cursor/rules/                     # AI 开发规则
│   ├── odoo-development.md            # Odoo 开发规范
│   ├── python-style.md                # Python 编码规范
│   ├── xml-views.md                   # XML 视图编写规范
│   ├── security-rules.md              # 安全规范
│   ├── testing.md                     # 测试规范
│   └── git-workflow.md                # Git 工作流规范
│
├── odoo/                              # Odoo 源码（Git Submodule）
├── custom_addons/                     # 自定义模块（核心开发区）
│   ├── erp_base/                      # 基础平台模块
│   ├── erp_sale/                      # 销售管理模块
│   ├── erp_purchase/                  # 采购管理模块
│   ├── erp_stock/                     # 库存管理模块
│   ├── erp_account/                   # 财务管理模块
│   ├── erp_report/                    # 报表中心模块
│   └── erp_integration/              # 外部集成模块
│
├── scripts/scaffold.py                # 模块脚手架生成器
├── templates/module_template/         # 模块模板（脚手架用）
├── docker-compose.yml                 # 开发环境编排（详见该文件）
├── Makefile                           # 常用命令快捷方式（详见该文件）
└── .github/workflows/ci.yml           # CI/CD 流水线（详见该文件）
```

> **说明**：Docker 环境配置详见 `docker-compose.yml`，常用命令详见 `Makefile`，CI/CD 流水线详见 `.github/workflows/ci.yml`。

---

## 3. AI 辅助工具链

### 3.1 Cursor Rules 规划

#### `odoo-development.md` — Odoo 开发核心规范

- 模块命名：`erp_` 前缀
- 模型命名：使用点分隔（`erp.sale.order`）
- 继承规范：优先 `_inherit`，避免改源码
- 视图规范：XML ID 命名约定
- 安全规范：每个模型必须有 `ir.model.access`
- 字段规范：必须有 `string` 参数（中文标签）
- 方法规范：业务方法以 `action_` 开头
- 计算字段：使用 `@api.depends` 装饰器
- 代码注释：关键业务逻辑必须有中文注释

#### `python-style.md` — Python 编码规范

- 遵循 PEP 8
- 类型注解：函数参数和返回值
- Docstring：Google 风格
- Import 顺序：标准库 → 第三方 → Odoo → 自定义
- 异常处理：具体异常类型，不用裸 `except`
- 日志级别：debug/info/warning/error 使用场景

#### `xml-views.md` — XML 视图规范

- Form 视图：header + sheet + chatter 标准结构
- Tree 视图：默认字段选择规范
- Search 视图：常用筛选器和分组
- Kanban 视图：卡片内容规范
- 继承视图：xpath 表达式编写规范
- 菜单结构：层级和排序规范

### 3.2 Prompt 模板库设计

Prompt 模板库位于 `docs/prompts/`，包含核心模板：创建模块/模型/视图、扩展模型、创建向导/报表、配置权限、创建测试、排查错误、Gap-Fit 分析等。每个模板包含场景描述、输入信息、输出规范、示例和注意事项。

---

## 4. 模块脚手架系统

### 4.1 脚手架功能

`scripts/scaffold.py` 支持以下模块类型：

- `basic` → 基础模块（模型 + 视图 + 权限）
- `extend` → 扩展模块（继承已有模块）
- `integration` → 集成模块（外部 API 对接）
- `report` → 报表模块（QWeb 报表）
- `wizard` → 向导模块（批量操作）

### 4.2 使用方式

```bash
# 方式一：命令行
python scripts/scaffold.py --name erp_sale --type basic --desc "销售管理"

# 方式二：AI 辅助（推荐）
# 在 Cursor 中直接对 AI 说：
# "创建一个销售管理模块 erp_sale，包含销售订单和客户管理功能"
```

> AI 方式的优势在于它可以根据业务描述智能生成字段和视图，而不是空模板。

### 4.3 标准模块模板

标准模块模板位于 `templates/module_template/`，包含：模块声明（`__manifest__.py.j2`）、模型模板、视图模板（form/tree/search/menu）、权限模板、初始数据、测试模板、模块图标和说明。

---

## 5. 代码质量体系

### 5.1 质量检查工具链

**提交前（Pre-commit hooks）**：
- pylint-odoo → Odoo 专用 lint 规则
- flake8 → Python 代码风格
- isort → Import 排序
- black → 代码格式化
- xmllint → XML 格式检查

**提交后（CI/CD Pipeline）**：
- pylint-odoo → 完整的 Odoo lint 检查
- pytest + coverage → 单元测试 + 覆盖率
- odoo test runner → Odoo 模块测试
- security scan → 安全漏洞扫描

> **说明**：CI/CD 流水线配置详见 `.github/workflows/ci.yml`。

### 5.2 代码审查清单

AI 代码审查检查项（每次提交前）：功能完整性（模型字段、视图、权限）、Odoo 规范（命名、继承、XML ID）、安全性（访问控制、SQL/XSS 风险）、性能（查询优化、索引、计算字段）、可维护性（注释、方法长度、业务逻辑清晰度）。

---

## 6. Git 工作流规范

### 6.1 分支策略

```
main (production)
 │
 ├── release/v1.0.0          # 发布分支
 │    └── hotfix/fix-xxx      # 紧急修复
 │
 ├── develop                  # 开发主分支
 │    ├── feature/erp-base    # 功能分支：基础模块
 │    ├── feature/erp-sale    # 功能分支：销售模块
 │    ├── feature/erp-stock   # 功能分支：库存模块
 │    └── feature/integration # 功能分支：外部集成
 │
 └── experimental/xxx         # 实验性分支
```

### 6.2 提交规范

提交信息格式：`<type>(<scope>): <subject>`

**type**：
- `feat` → 新功能
- `fix` → 修复
- `refactor` → 重构
- `docs` → 文档
- `test` → 测试
- `chore` → 构建/工具
- `style` → 格式调整

**scope**：
- `base` → erp_base 模块
- `sale` → erp_sale 模块
- `purchase` → erp_purchase 模块
- `stock` → erp_stock 模块
- `account` → erp_account 模块
- `infra` → 基础设施
- `docs` → 文档

**示例**：
- `feat(sale): 添加销售订单多级审批功能`
- `fix(stock): 修复库存盘点数量计算错误`
- `docs(base): 更新权限配置说明文档`

---

## 变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|---------|
| v0.1.0 | 2026-02-15 | AI + 项目负责人 | 初始版本 |
| v0.2.0 | 2026-02-15 | AI + 项目负责人 | 添加 Phase 0B 配置规划 |
| v0.3.0 | 2026-02-16 | AI + 项目负责人 | 精简文档，删除已实现的配置规划细节，改为引用实际文件 |
