# 需求建模方法

> 状态: **已细化** | 版本: v0.2.0 | 创建: 2026-02-16 | 更新: 2026-02-18
>
> 指导如何将 Gap-Fit 分析结果中的 Gap/Partial 项转化为可实施的结构化模型。
> 已通过 ERP 项目 REQ-PUR-019（供应商评分）试点验证。

---

## 定位

将业务需求转化为 5 类结构化模型：BPMN 流程图、UML 数据模型、RBAC 权限矩阵、BDD 行为规格、ArchiMate 架构图。

与 Gap-Fit 方法的衔接：Gap-Fit 标记"做什么"，需求建模定义"怎么做"。

## 前置条件

- Gap-Fit 分析已完成（知道哪些需求需要建模）
- 建模标准已确认（[03-建模体系](../../00-方法论/03-建模体系/README.md)）
- 工具：draw.io（BPMN/UML）、Archi（ArchiMate）、Markdown（RBAC/BDD）

## 步骤（5 步）

### Step 1: 需求概述表

**做什么**：为待建模需求建立上下文卡片。

**AI 引导问题**：
- 这个需求的业务价值是什么？
- 涉及哪些角色？
- 在 Odoo 中是新建模块还是扩展已有模块？

**操作要点**：
- 从 Gap-Fit 报告中提取编号、描述、匹配度、优先级、工作量
- 补充业务价值（一句话说明"为什么要做"）
- 明确与 Odoo 标准模块的关系（新建 / 继承扩展）

**输出**：需求概述表（Markdown 表格）

### Step 2: BPMN 业务流程建模

**做什么**：用 BPMN 2.0 绘制业务流程图，明确参与者、活动序列、决策点。

**AI 引导问题**：
- 这个流程的触发条件是什么？（手动 / 定时 / 事件驱动）
- 有哪些分支路径？（正常流 / 异常流 / 审批拒绝）
- 流程的终态有几种？

**操作要点**：
- 用 Mermaid flowchart 快速出初稿（AI 辅助）
- 有条件再转 draw.io 正式版
- 保持粒度适中：一个流程图 5~15 个活动节点
- 1 人 + AI 模式下，Mermaid 初稿足够驱动开发

**输出**：`models/bpmn/{需求编号}-{名称}.md`（含 Mermaid 图）

**试点经验**（ERP REQ-PUR-019）：
- 供应商评分主流程用 Mermaid 画了 12 个节点，覆盖手动评分和自动评分两条路径
- Mermaid 初稿 → 开发的转化效率高于 draw.io 正式图

### Step 3: UML 数据模型设计

**做什么**：用 UML 类图定义数据结构和模型关系。

**AI 引导问题**：
- 需要哪些新模型？每个模型的核心字段是什么？
- 与 Odoo 标准模型（res.partner / purchase.order 等）的关系是什么？
- 有哪些计算字段？触发逻辑是什么？

**操作要点**：
- 用 Mermaid classDiagram 出初稿
- 标注字段类型、约束、与 Odoo 标准模型的继承/关联关系
- 对 Odoo 项目：模型名用点分隔（`erp.vendor.rating`），字段用 `string` 中文标签

**输出**：`models/uml/{需求编号}-class-diagram.md`（含 Mermaid 图）

**试点经验**：
- 供应商评分设计了 3 个模型（评分规则、评分记录、评分明细），字段直接映射 Odoo `fields` 定义
- UML 图中标注 `_inherit = 'res.partner'` 扩展关系，可直接转为代码骨架

### Step 4: RBAC 权限矩阵

**做什么**：定义角色与操作权限的对应关系。

**AI 引导问题**：
- 谁可以发起？谁可以审批？谁可以查看？
- 是否需要行级权限（只能看自己部门的数据）？
- 与 Odoo 标准安全组的继承关系是什么？

**操作要点**：
- 用 Markdown 表格（角色 × 操作）
- 标注与 Odoo 标准组的 `implied_ids` 继承关系
- 注意 `implied_ids` 的隐含效果：子组自动获得父组的全部权限

**输出**：RBAC 权限矩阵（Markdown 表格，嵌入建模文档）

**试点经验**：
- 供应商评分定义了 4 个角色（采购员/采购经理/质量经理/管理员）
- 发现 `implied_ids` 设计不当会导致权限泄露，建模阶段明确继承链很关键

### Step 5: BDD 行为规格

**做什么**：用 Given/When/Then 格式描述关键场景的预期行为。

**AI 引导问题**：
- 正常路径有几个？（happy path）
- 异常路径有哪些？（权限不足 / 数据缺失 / 边界值）
- 每个场景的验收标准是什么？

**操作要点**：
- 每个需求至少 3 个 BDD 场景（正常 + 2 个异常）
- BDD 场景可直接转为 Odoo `TransactionCase` 测试用例
- 用中文写 Given/When/Then，保持业务可读性

**输出**：BDD 场景列表（Markdown，嵌入建模文档）

**试点经验**：
- 供应商评分写了 6 个 BDD 场景，其中 2 个异常场景在开发时发现了设计遗漏
- BDD 到测试代码的转化率约 80%（部分场景需要调整 Odoo 测试框架约束）

## 检查清单

- [ ] 需求概述表已填写（编号、描述、业务价值、Odoo 关系）
- [ ] BPMN 流程图已创建（覆盖正常流 + 至少 1 个异常流）
- [ ] UML 类图已创建（含字段类型、模型关系、Odoo 继承标注）
- [ ] RBAC 权限矩阵已定义（含 Odoo 安全组继承关系）
- [ ] BDD 场景已编写（至少 3 个：1 正常 + 2 异常）
- [ ] 所有模型文件已存入 `models/` 目录

## 输出

- `docs/02-项目/需求建模-{需求名}.md` — 完整建模文档（5 个部分合一）
- `models/bpmn/` — BPMN 流程图（Mermaid / draw.io）
- `models/uml/` — UML 类图（Mermaid / draw.io）

## 方法论引用

- [03-建模体系](../../00-方法论/03-建模体系/README.md)（建模标准和工具选择）
- [04-设计模式/DDD](../../00-方法论/04-设计模式与开发实践/README.md)（领域划分）
- [04-设计模式/BDD](../../00-方法论/04-设计模式与开发实践/README.md)（行为规格）

## 变更记录

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v0.1.0 | 2026-02-16 | 纲要创建 |
| v0.2.0 | 2026-02-18 | 从纲要细化为完整方法：5 步骤含 AI 引导问题/操作要点/输出 + ERP 试点经验回流 |
